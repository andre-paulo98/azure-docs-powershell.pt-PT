---
title: Migrar scripts do Azure PowerShell do AzureRM para o Az
description: Conheça os passos e as ferramentas para migrar scripts do módulo do AzureRM para o novo módulo do Az.
author: sptramer
ms.author: sttramer
manager: carmonm
ms.devlang: powershell
ms.topic: conceptual
ms.date: 05/10/2019
ms.openlocfilehash: 02b39653ebb4aa0f74d2340a7be7b35e08d5e44d
ms.sourcegitcommit: f6fa6543be1e0f6330b1598f01528b2928cc426c
ms.translationtype: HT
ms.contentlocale: pt-PT
ms.lasthandoff: 03/10/2020
ms.locfileid: "79035656"
---
# <a name="migrate-azure-powershell-from-azurerm-to-az"></a><span data-ttu-id="8d35b-103">Migrar o Azure PowerShell do AzureRM para o Az</span><span class="sxs-lookup"><span data-stu-id="8d35b-103">Migrate Azure PowerShell from AzureRM to Az</span></span>

<span data-ttu-id="8d35b-104">O módulo do Az tem paridade de funcionalidades com o AzureRM, mas utiliza nomes de cmdlet mais curtos e mais consistentes.</span><span class="sxs-lookup"><span data-stu-id="8d35b-104">The Az module has feature parity with AzureRM, but uses shorter and more consistent cmdlet names.</span></span>
<span data-ttu-id="8d35b-105">Os scripts escritos para os cmdlets do AzureRM não irão funcionar automaticamente com o módulo novo.</span><span class="sxs-lookup"><span data-stu-id="8d35b-105">Scripts written for the AzureRM cmdlets won't automatically work with the new module.</span></span> <span data-ttu-id="8d35b-106">Para facilitar a transição, o Az oferece ferramentas para permitir a execução dos seus scripts existentes com o AzureRM.</span><span class="sxs-lookup"><span data-stu-id="8d35b-106">To make the transition easier, Az offers tools to allow you to run your existing scripts using AzureRM.</span></span> <span data-ttu-id="8d35b-107">Uma migração para um novo conjunto de comandos nunca é conveniente, mas este artigo ajuda-o a fazer a transição para o novo módulo.</span><span class="sxs-lookup"><span data-stu-id="8d35b-107">No migration to a new command set is ever convenient, but this article will help you get started on transitioning to the new module.</span></span>

<span data-ttu-id="8d35b-108">Para ver a lista completa das alterações interruptivas entre o AzureRM e o Az, veja [todas as alterações do AzureRM para o Az](migrate-az-1.0.0.md).</span><span class="sxs-lookup"><span data-stu-id="8d35b-108">To see the full list of breaking changes between AzureRM and Az, see the [full changes from AzureRM to Az](migrate-az-1.0.0.md).</span></span>

## <a name="ensure-existing-scripts-work-with-the-latest-azurerm-release"></a><span data-ttu-id="8d35b-109">Certifique-se de que os scripts existentes funcionam com a versão mais recente do AzureRM</span><span class="sxs-lookup"><span data-stu-id="8d35b-109">Ensure existing scripts work with the latest AzureRM release</span></span>

<span data-ttu-id="8d35b-110">Antes de realizar quaisquer passos de migração, verifique quais são as versões do AzureRM que se encontram instaladas no sistema.</span><span class="sxs-lookup"><span data-stu-id="8d35b-110">Before taking any migration steps, check which versions of AzureRM are installed on your system.</span></span> <span data-ttu-id="8d35b-111">Ao fazê-lo, certifica-se de que os scripts já estão em execução na versão mais recente e fica a saber que versões do AzureRM têm de ser desinstaladas.</span><span class="sxs-lookup"><span data-stu-id="8d35b-111">Doing so allows you to make sure scripts are already running on the latest release, and let you know which versions of AzureRM must be uninstalled.</span></span>

<span data-ttu-id="8d35b-112">Para verificar quais são as versões do AzureRM que se encontram instaladas, execute o comando:</span><span class="sxs-lookup"><span data-stu-id="8d35b-112">To check which version(s) of AzureRM you have installed, run the command:</span></span>

```powershell-interactive
Get-InstalledModule -Name AzureRM -AllVersions
```

<span data-ttu-id="8d35b-113">A versão __mais recente__ disponível do AzureRM é a __6.13.1__.</span><span class="sxs-lookup"><span data-stu-id="8d35b-113">The __latest__ available release of AzureRM is __6.13.1__.</span></span> <span data-ttu-id="8d35b-114">Se não tiver esta versão instalada, os seus scripts existentes poderão precisar de modificações adicionais para funcionar com o módulo Az para além do que foi descrito aqui e na [lista de alterações interruptivas](migrate-az-1.0.0.md).</span><span class="sxs-lookup"><span data-stu-id="8d35b-114">If you don't have this version installed, your existing scripts may need additional modification to work with the Az module beyond what's described here and in the [breaking changes list](migrate-az-1.0.0.md).</span></span>

<span data-ttu-id="8d35b-115">Se os scripts não funcionarem com o AzureRM 6.13.1, atualize-os de acordo com o [guia de migração do AzureRM 5.x para o 6.x](/powershell/azure/azurerm/migration-guide.6.0.0).</span><span class="sxs-lookup"><span data-stu-id="8d35b-115">If your scripts don't work with AzureRM 6.13.1, update them according to the [AzureRM 5.x to 6.x migration guide](/powershell/azure/azurerm/migration-guide.6.0.0).</span></span>
<span data-ttu-id="8d35b-116">Se utilizar uma versão anterior do módulo AzureRM, existem guias de migração disponíveis para cada versão principal.</span><span class="sxs-lookup"><span data-stu-id="8d35b-116">If you use an earlier version of the AzureRM module, there are migration guides available for each major version.</span></span>

## <a name="uninstall-azurerm"></a><span data-ttu-id="8d35b-117">Desinstalar o AzureRM</span><span class="sxs-lookup"><span data-stu-id="8d35b-117">Uninstall AzureRM</span></span>

<span data-ttu-id="8d35b-118">Não é garantido que o módulo Az seja compatível com quaisquer instalações existentes do AzureRM no PowerShell 5.1 para Windows.</span><span class="sxs-lookup"><span data-stu-id="8d35b-118">The Az module is not guaranteed to be compatible with any existing AzureRM installs in PowerShell 5.1 for Windows.</span></span> <span data-ttu-id="8d35b-119">Antes de instalar o módulo Az, [desinstale o AzureRM](/powershell/azure/uninstall-az-ps#uninstall-the-azurerm-module).</span><span class="sxs-lookup"><span data-stu-id="8d35b-119">Before you install the Az module, [uninstall AzureRM](/powershell/azure/uninstall-az-ps#uninstall-the-azurerm-module).</span></span>

> [!IMPORTANT]
>
> <span data-ttu-id="8d35b-120">Se não estiver pronto para remover o módulo AzureRM do sistema, pode antes instalar o módulo Az para o [PowerShell Core](/powershell/scripting/install/installing-powershell-core-on-windows) 6.x ou versão posterior.</span><span class="sxs-lookup"><span data-stu-id="8d35b-120">If you're not ready to remove the AzureRM module from your system, you can install the Az module for [PowerShell Core](/powershell/scripting/install/installing-powershell-core-on-windows) 6.x or later instead.</span></span> <span data-ttu-id="8d35b-121">O PowerShell Core e o PowerShell 5.1 para Windows utilizam diferentes bibliotecas de módulos, pelo que não ocorrerão conflitos.</span><span class="sxs-lookup"><span data-stu-id="8d35b-121">PowerShell Core and PowerShell 5.1 for Windows use different module libraries, so there will be no conflicts.</span></span> <span data-ttu-id="8d35b-122">Continua a poder [ativar aliases](#enable-azurerm-compatibility-aliases) no PowerShell Core.</span><span class="sxs-lookup"><span data-stu-id="8d35b-122">You can still [enable aliases](#enable-azurerm-compatibility-aliases) in PowerShell Core.</span></span>

## <a name="install-the-azure-powershell-az-module"></a><span data-ttu-id="8d35b-123">Instalar o módulo do Azure PowerShell Az</span><span class="sxs-lookup"><span data-stu-id="8d35b-123">Install the Azure PowerShell Az module</span></span>

<span data-ttu-id="8d35b-124">O primeiro passo é instalar o módulo do Az na sua plataforma.</span><span class="sxs-lookup"><span data-stu-id="8d35b-124">The first step is to install the Az module on your platform.</span></span> <span data-ttu-id="8d35b-125">Quando instalar o Az, recomenda-se que desinstale o AzureRM.</span><span class="sxs-lookup"><span data-stu-id="8d35b-125">When you install Az, it's recommended that you uninstall AzureRM.</span></span> <span data-ttu-id="8d35b-126">Nos passos seguintes, irá aprender como continuar a executar os scripts existentes e permitir a compatibilidade dos nomes de cmdlet antigos.</span><span class="sxs-lookup"><span data-stu-id="8d35b-126">In the following steps, you'll learn how to keep running your existing scripts and enable compatibility for old cmdlet names.</span></span>

<span data-ttu-id="8d35b-127">Para instalar o módulo Az do Azure PowerShell, siga as instruções em [Instalar o módulo Az](install-az-ps.md).</span><span class="sxs-lookup"><span data-stu-id="8d35b-127">To install the Azure PowerShell Az module, follow the instructions in [Install the Az module](install-az-ps.md).</span></span>

> [!NOTE]
> <span data-ttu-id="8d35b-128">Neste momento, poderá querer executar o cmdlet [Uninstall-AzureRM](/powershell/module/az.accounts/uninstall-azurerm) fornecido no módulo Az, apenas para se certificar de que todas as versões do AzureRM foram desinstaladas e não causarão conflitos.</span><span class="sxs-lookup"><span data-stu-id="8d35b-128">At this point, you might want to run the [Uninstall-AzureRM](/powershell/module/az.accounts/uninstall-azurerm) cmdlet provided in the Az module, just to make sure that all versions of AzureRM have been uninstalled and won't cause conflicts.</span></span>

## <a name="enable-azurerm-compatibility-aliases"></a><span data-ttu-id="8d35b-129">Ativar aliases de compatibilidade do AzureRM</span><span class="sxs-lookup"><span data-stu-id="8d35b-129">Enable AzureRM compatibility aliases</span></span>

<span data-ttu-id="8d35b-130">Com o AzureRM desinstalado e os scripts a funcionarem com a versão mais recente do AzureRM, chegou o momento de ativar o modo de compatibilidade para o módulo do Az.</span><span class="sxs-lookup"><span data-stu-id="8d35b-130">With AzureRM uninstalled and your scripts working with the latest AzureRM version, the next step is to enable the compatibility mode for the Az module.</span></span> <span data-ttu-id="8d35b-131">A compatibilidade é ativada com o comando:</span><span class="sxs-lookup"><span data-stu-id="8d35b-131">Compatibility is enabled with the command:</span></span>

```powershell-interactive
Enable-AzureRmAlias -Scope CurrentUser
```

<span data-ttu-id="8d35b-132">Os aliases ativam a capacidade de utilizar nomes de cmdlets antigos com o módulo do Az instalado.</span><span class="sxs-lookup"><span data-stu-id="8d35b-132">Aliases enable the ability to use old cmdlet names with the Az module installed.</span></span> <span data-ttu-id="8d35b-133">Estes aliases são escritos para o perfil do âmbito selecionado.</span><span class="sxs-lookup"><span data-stu-id="8d35b-133">These aliases are written to the profile for the selected scope.</span></span> <span data-ttu-id="8d35b-134">Se não existir um perfil, é criado um.</span><span class="sxs-lookup"><span data-stu-id="8d35b-134">If no profile exists, one is created.</span></span>
<span data-ttu-id="8d35b-135">Quando utilizar um `-Scope` mais amplo do que `CurrentUser`, são necessárias as permissões adequadas para criar ou atualizar o ficheiro de perfil correspondente.</span><span class="sxs-lookup"><span data-stu-id="8d35b-135">When using a `-Scope` broader than `CurrentUser`, the appropriate permissions are required to create or update the corresponding profile file.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="8d35b-136">__Apenas__ os nomes de cmdlet têm aliases. Os nomes dos módulos não têm!</span><span class="sxs-lookup"><span data-stu-id="8d35b-136">__Only__ cmdlet names are aliased - module names aren't!</span></span> <span data-ttu-id="8d35b-137">Se estiver a utilizar `#Requires`, `Import-Module`, listas de dependência num `.psd1` ou nomes de cmdlet completamente qualificados, certifique-se de que os migra neste momento através do processo descrito na [lista de alterações interruptivas](migrate-az-1.0.0.md) relativa aos nomes de módulos.</span><span class="sxs-lookup"><span data-stu-id="8d35b-137">If you're using `#Requires`, `Import-Module`, dependency lists in a `.psd1`, or fully-qualified cmdlet names, make sure that you migrate them at this point by following the process outlined in the [breaking changes list](migrate-az-1.0.0.md) regarding module names.</span></span>

> [!WARNING]
>
> <span data-ttu-id="8d35b-138">Pode utilizar um `-Scope` diferente para este comando, mas tal não é recomendado.</span><span class="sxs-lookup"><span data-stu-id="8d35b-138">You can use a different `-Scope` for this command, but it's not recommended.</span></span> <span data-ttu-id="8d35b-139">Os aliases são escritos para o perfil de utilizador para o âmbito selecionado, por isso continue a permitir que tenham um âmbito o mais limitado possível.</span><span class="sxs-lookup"><span data-stu-id="8d35b-139">Aliases are written to the user profile for the selected scope, so keep enabling them to as limited a scope as possible.</span></span> <span data-ttu-id="8d35b-140">A ativação dos aliases no sistema em geral pode causar problemas a outros utilizadores que tenham o AzureRM instalado no respetivo âmbito local.</span><span class="sxs-lookup"><span data-stu-id="8d35b-140">Enabling aliases system-wide can cause issues for other users who have AzureRM installed in their local scope.</span></span>

<span data-ttu-id="8d35b-141">Assim que o modo de alias estiver ativado, execute os seus scripts novamente para confirmar que ainda funcionam como esperado.</span><span class="sxs-lookup"><span data-stu-id="8d35b-141">Once the alias mode is enabled, run your scripts again to confirm that they still function as expected.</span></span>
<span data-ttu-id="8d35b-142">Alguns nomes de parâmetro foram alterados, adicionados ou passaram a ser obrigatórios para o módulo Az.</span><span class="sxs-lookup"><span data-stu-id="8d35b-142">Some parameter names have been changed, added, or made required by the Az module.</span></span> <span data-ttu-id="8d35b-143">Os tipos de saída dos cmdlets também podem ter sido alterados.</span><span class="sxs-lookup"><span data-stu-id="8d35b-143">Output types of cmdlets may have changed as well.</span></span> <span data-ttu-id="8d35b-144">Estas alterações estão detalhadas na [lista de alterações interruptivas](migrate-az-1.0.0.md).</span><span class="sxs-lookup"><span data-stu-id="8d35b-144">These changes are detailed in the [breaking changes list](migrate-az-1.0.0.md).</span></span>

## <a name="update-cmdlets-modules-and-parameters"></a><span data-ttu-id="8d35b-145">Atualizar cmdlets, módulos e parâmetros</span><span class="sxs-lookup"><span data-stu-id="8d35b-145">Update cmdlets, modules, and parameters</span></span>

<span data-ttu-id="8d35b-146">Com os scripts atualizados e em execução nos aliases, pode atualizá-los quando quiser para que utilizem os novos cmdlets e tirem partido de outras alterações, como novas funcionalidades.</span><span class="sxs-lookup"><span data-stu-id="8d35b-146">With scripts updated and running under aliases, you can take your time to update them to use the new cmdlets and take advantage of other changes like new features.</span></span> <span data-ttu-id="8d35b-147">Para a maioria dos scripts, apenas terá de atualizar os nomes dos cmdlets, pelo que terá de [seguir o novo esquema de nomenclatura de cmdlets no Az](migrate-az-1.0.0.md#cmdlet-noun-prefix-changes).</span><span class="sxs-lookup"><span data-stu-id="8d35b-147">For most scripts, you will only need to update cmdlet names, [following the new cmdlet naming scheme in Az](migrate-az-1.0.0.md#cmdlet-noun-prefix-changes).</span></span> <span data-ttu-id="8d35b-148">Também poderá haver outras alterações que terá de fazer para que os seus scripts funcionem, consoante a função dos mesmos e das funcionalidades do Azure PowerShell de que tiram partido.</span><span class="sxs-lookup"><span data-stu-id="8d35b-148">There may also be some other changes that you need to make in order to have your scripts work, depending on what they do and which Azure PowerShell features they take advantage of.</span></span>

<span data-ttu-id="8d35b-149">Por exemplo, os [cmdlets do Armazenamento de Blobs](migrate-az-1.0.0.md#azstorage-previously-azurestorage-and-azurermstorage) foram completamente reformulados de forma a utilizar um novo modelo assíncrono, pelo que será mais difícil atualizar os scripts que utilizem estes cmdlets do que os scripts em que as únicas alterações relevantes foram alterações de nomes de cmdlet.</span><span class="sxs-lookup"><span data-stu-id="8d35b-149">For example, the [Blob Storage cmdlets](migrate-az-1.0.0.md#azstorage-previously-azurestorage-and-azurermstorage) have been completely reworked to use a new asynchronous model, so scripts using them will take more work to update than those where the only relevant changes were cmdlet names.</span></span>

<span data-ttu-id="8d35b-150">Mesmo que apenas tenha tido de fazer alterações pequenas e simples aos seus scripts até este momento, ou ainda que funcionem sem modificações adicionais quando os aliases estão ativados, leia a [lista completa de alterações interruptivas no Az 1.0.0](migrate-az-1.0.0.md) para se certificar de que não está dependente do comportamento "transparente" de aliases que poderão desaparecer depois de alterar os nomes dos cmdlets e desativar os aliases.</span><span class="sxs-lookup"><span data-stu-id="8d35b-150">Even if you've only had to make small, simple changes to your scripts up to this point - or they even work without additional modification when aliases are enabled -  read the [full list of breaking changes in Az 1.0.0](migrate-az-1.0.0.md) to make sure that you're not relying on 'transparent' behavior of aliases which could disappear after you change cmdlet names and disable aliases.</span></span>

## <a name="disable-aliases"></a><span data-ttu-id="8d35b-151">Desativar aliases</span><span class="sxs-lookup"><span data-stu-id="8d35b-151">Disable aliases</span></span>

<span data-ttu-id="8d35b-152">Depois de concluir a migração e de já não estar dependente do comportamento dos aliases, recomendamos que desative os aliases.</span><span class="sxs-lookup"><span data-stu-id="8d35b-152">Once you've completed your migration and are no longer relying on aliasing behavior, it's recommended that you disable aliases.</span></span> <span data-ttu-id="8d35b-153">Para isso, utilize o cmdlet [Disable-AzureRmAlias](/powershell/module/az.accounts/disable-azurermalias).</span><span class="sxs-lookup"><span data-stu-id="8d35b-153">This is done with the [Disable-AzureRmAlias](/powershell/module/az.accounts/disable-azurermalias) cmdlet.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="8d35b-154">Quando executar este cmdlet, __certifique-se__ de que o invoca para cada `-Scope` para os quais `Enable-AzureRmAlias` foi invocado. Caso contrário, poderá continuar a existir scripts no seu sistema dependentes do comportamento dos aliases.</span><span class="sxs-lookup"><span data-stu-id="8d35b-154">When running this cmdlet, __make sure__ that you invoke it for each `-Scope` that `Enable-AzureRmAlias` was invoked for, otherwise there may still be scripts on your system relying on the aliasing behavior.</span></span>
